using Microsoft.AspNetCore.Mvc; using BookStoreApi.Repositories; using BookStoreApi.Dtos; using BookStoreApi.Models; using AutoMapper; namespace BookStoreApi.Controllers; [ApiController] [Route("api/[controller]")] public class BooksController : ControllerBase { private readonly IBookRepository _repo; private readonly IMapper _mapper; public BooksController(IBookRepository repo, IMapper mapper){ _repo = repo; _mapper = mapper; } [HttpGet] public async Task<IActionResult> GetAll(){ var items = await _repo.GetAllAsync(); return Ok(items.Select(i=>_mapper.Map<BookDto>(i))); } [HttpGet("{id}")] public async Task<IActionResult> GetById(int id){ var item = await _repo.GetByIdAsync(id); if(item==null) return NotFound(); return Ok(_mapper.Map<BookDto>(item)); } [HttpPost] public async Task<IActionResult> Create([FromBody] BookCreateDto dto){ var book = _mapper.Map<Book>(dto); var created = await _repo.CreateAsync(book); return CreatedAtAction(nameof(GetById), new { id = created.Id }, _mapper.Map<BookDto>(created)); } [HttpPut("{id}")] public async Task<IActionResult> Replace(int id, [FromBody] BookCreateDto dto){ var book = _mapper.Map<Book>(dto); var updated = await _repo.ReplaceAsync(id, book); return Ok(_mapper.Map<BookDto>(updated)); } [HttpPatch("{id}")] public async Task<IActionResult> Patch(int id, [FromBody] BookUpdateDto dto){ var updated = await _repo.UpdateAsync(id, dto); if(updated==null) return NotFound(); return Ok(_mapper.Map<BookDto>(updated)); } [HttpDelete("{id}")] public async Task<IActionResult> Delete(int id){ await _repo.DeleteAsync(id); return Ok(new { deleted = true }); } }
