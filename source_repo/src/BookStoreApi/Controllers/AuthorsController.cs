using Microsoft.AspNetCore.Mvc; using BookStoreApi.Repositories; using BookStoreApi.Dtos; using BookStoreApi.Models; using AutoMapper; namespace BookStoreApi.Controllers; [ApiController] [Route("api/[controller]")] public class AuthorsController : ControllerBase { private readonly IAuthorRepository _repo; private readonly IMapper _mapper; public AuthorsController(IAuthorRepository repo, IMapper mapper){ _repo = repo; _mapper = mapper; } [HttpGet] public async Task<IActionResult> GetAll(){ var items = await _repo.GetAllAsync(); return Ok(items.Select(i=>_mapper.Map<AuthorDto>(i))); } [HttpGet("{id}")] public async Task<IActionResult> GetById(int id){ var item = await _repo.GetByIdAsync(id); if(item==null) return NotFound(); return Ok(_mapper.Map<AuthorDto>(item)); } [HttpPost] public async Task<IActionResult> Create([FromBody] AuthorCreateDto dto){ var author = _mapper.Map<Author>(dto); var created = await _repo.CreateAsync(author); return CreatedAtAction(nameof(GetById), new { id = created.Id }, _mapper.Map<AuthorDto>(created)); } [HttpPut("{id}")] public async Task<IActionResult> Replace(int id, [FromBody] AuthorCreateDto dto){ var author = _mapper.Map<Author>(dto); var updated = await _repo.ReplaceAsync(id, author); return Ok(_mapper.Map<AuthorDto>(updated)); } [HttpPatch("{id}")] public async Task<IActionResult> Patch(int id, [FromBody] AuthorUpdateDto dto){ var updated = await _repo.UpdateAsync(id, dto); if(updated==null) return NotFound(); return Ok(_mapper.Map<AuthorDto>(updated)); } [HttpDelete("{id}")] public async Task<IActionResult> Delete(int id){ await _repo.DeleteAsync(id); return Ok(new { deleted = true }); } }
