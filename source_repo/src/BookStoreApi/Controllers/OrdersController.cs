using Microsoft.AspNetCore.Mvc; using BookStoreApi.Repositories; using BookStoreApi.Dtos; using BookStoreApi.Models; using AutoMapper; namespace BookStoreApi.Controllers; [ApiController] [Route("api/[controller]")] public class OrdersController : ControllerBase { private readonly IOrderRepository _repo; private readonly IMapper _mapper; public OrdersController(IOrderRepository repo, IMapper mapper){ _repo = repo; _mapper = mapper; } [HttpGet] public async Task<IActionResult> GetAll(){ var items = await _repo.GetAllAsync(); return Ok(items.Select(i=>_mapper.Map<OrderDto>(i))); } [HttpGet("{id}")] public async Task<IActionResult> GetById(int id){ var item = await _repo.GetByIdAsync(id); if(item==null) return NotFound(); return Ok(_mapper.Map<OrderDto>(item)); } [HttpPost] public async Task<IActionResult> Create([FromBody] OrderCreateDto dto){ var order = _mapper.Map<Order>(dto); var created = await _repo.CreateAsync(order); return CreatedAtAction(nameof(GetById), new { id = created.Id }, _mapper.Map<OrderDto>(created)); } [HttpPut("{id}")] public async Task<IActionResult> Replace(int id, [FromBody] OrderCreateDto dto){ var order = _mapper.Map<Order>(dto); var updated = await _repo.ReplaceAsync(id, order); return Ok(_mapper.Map<OrderDto>(updated)); } [HttpPatch("{id}")] public async Task<IActionResult> Patch(int id, [FromBody] OrderUpdateDto dto){ var updated = await _repo.UpdateAsync(id, dto); if(updated==null) return NotFound(); return Ok(_mapper.Map<OrderDto>(updated)); } [HttpDelete("{id}")] public async Task<IActionResult> Delete(int id){ await _repo.DeleteAsync(id); return Ok(new { deleted = true }); } }
